# 数据库备份

## 最佳实践

### 考察问

1. 备份方法
    1. 静态备份(冷备份)
    2. 动态备份(热备份)
2. 备份数量
    1. ()备份
    2. ()备份: 减上一次备份(任何类型的: 包含完全, 差量, 增量)
    3. ()备份: 减上一次全量备份

### 考察点

1. 备份方法
    1. 静态备份(冷备份)
    2. 动态备份(热备份)
2. 备份数量
    1. 全量备份
    2. 增量备份: 减上一次备份(完全, 差量, 增量)
    3. 差量备份: 减上一次全量备份


## 故障

|故障关系|故障原因|解决方法|
| ---- | ---- | ---- |
|事务本身的可预期故障|本身逻辑|在程序中预先设置Rollback语句|
|事务本身的不可预期故障|算术溢出、违反存储保护|由DBMS的恢复子系统通过日志，撤销事务对数据库的修改，回退到事务初始状态|
|系统故障|系统停止运转|通常使用检查点法(系统重启时自动完成)|
|介质故障|外存被破坏|一般使用日志重做业务|

- 撤销事务(UNDO)：故障发生时未完成的事务，放入Undo撤销。
- 重做事务(REDO)：故障发生前已提交的事务，放入Redo重做。



## 备份方法

1. 冷备份也称为静态备份，是将数据库正常关闭，在停止状态下，将数据库的文件全部备份(复制)下来。

    1. 优点是非常快速、容易归档(直接物理复制操作)
    2. 缺点是只能提供到某一时间点上的恢复，不能做其他工作

2. 热备份也称为动态备份，是利用备份软件，在数据库正常运行的状态下，将数据库中的数据文件备份出来。

    1. 优点是可在表空间或数据库文件级备份，数据库仍可使用，可达到秒级恢复；
    2. 缺点是不能出错，否则后果严重，若热备份不成功，所得结果几乎全部无效。


## 备份数量

1. 完全备份：备份所有数据。
2. 增量备份：备份上一次备份(完全, 或差量, 或增量)之后变化的数据。
3. 差量备份：仅备份上一次`完全备份`之后变化的数据。

|周日|周一|周二|周三|周四|周五|周六|
| ---- | ---- | ---- | ---- | ---- | ---- | ---- |
|全备|增备|增备|差备|增备|差备|增备|
|A|B|C|BCD|E|BCDEF|G

如果周六出现故障则:

1. 先找全备: A
2. 再找最近的差备: BCDEF
3. 再找最近的增备: G



## 🔒题目

1. 假设某证券公司的股票交易系统中有正在运行的事务，此时，若要转储该交易系统数据库中的全部数据，则应采用(  )方式。

    - A. 静态全局转储
    - B. 动态全局转储
    - C. 静态增量转储
    - D. 动态增量转储

    答案: B
