# 论系统安全架构设计及其应用


系统的安全架构设计主要有`鉴别服务`、`访问控制`、数据`完整性`校验、数据`保密性`和`抗抵赖`等5个方面，鉴于该运营商的业务特点，我们着重考虑了鉴别服务的能力和访问控制能力。鉴别技术主要有用户名+口令模式、数字证书和生物特征识别等技术。鉴别技术面临的主要目的是验明用户或者信息的正身，面临的威胁主要有用户名、口令被盗；生物特征被窃取、数字证书重放冒用等。访问控制主要有自主访问控制、访问列表控制、强制访问控制、基于角色的访问控制和基于任务的访问控制等技术。访问控制监控哪些资源可以被访问和使用，以及在某种情况下最大限度的降低未经授权行为的风险。无论是终端用户因疏忽而导致的敏感信息泄漏，还是因公共web服务器软件漏洞而导致的敏感信息泄漏，都可能造成灾难性后果。

在系统中，我们着重采用了生物特征识别方式来验证客户身份的准确性，采用访问控制列表和基于角色的访问控制来实现系统的访问控制技术。下文着重讨论这些技术在系统中的具体应用和实现。

一、生物特征识别

首先我们在受理业务的首页设置了客户认证菜单页，在客户认证通过的情况下才可以办理该客户下的业务，若认证未通过，则不允许受理任何业务。在用户受理业务时，我们首先要确保是实名办理业务，客户需要出示证件，系统调用第三方系统核实证件真伪，其次需要现场拍照，系统进行照片比对核对证件和证件持有人是否一致并将照片信息存储在后台hbase中，防止用户的业务被非法篡改，也防止别有用心的人利用账号从事非法活动，给国家和人民造成经济损失。只有当客户认证通过之后才可以正常办理业务。在受理业务之前通过生物特征识别校验用户的真伪性，在业务受理最后一个阶段需要采集用户的指纹或者在线签名，确保用户知道自己受理的具体业务内容，以及日后的防抵赖性。对于特殊类代办业务，系统需要验证代办人的证件资料，采集代办人的人脸信息，以及代办业务用户所收到的实时验证码，当验证码校验通过之后才运行受理该代办业务。

二、访问控制列表
访问控制列表主要是针对该运营商的网上商城业务而设计的，该运营商为了增加集团的收入，在手机app客户端和网上商城均开放了购物业务，用户可以使用话费购买商城的产品，比如京东卡、腾讯会员、生活用品等。由于账号和口令可能被暴力破解或者泄漏，所以如何在消费话费的时候确认该购买行为是该客户有意识的主动发起是我们遇到的最大的难题。因为客户可能是误操作，也可能账号是被盗取。还有可能是购买意愿不强烈，订单取消风险较大，但是某些商品如京东卡一旦售卖成功是不允许取消订单的，导致消费者的购买体验较差。经过慎重研究决定采用访问控制列表的方式来实现该购买行为。当购买行为进入支付阶段的时候系统会给用户发一条动态短信，若用户按照短信内容回复短信，则可以判断是用户的真实操作，才会进入真正的支付环节以及产品交付环节。该技术的应用成功拓展了业务领域，增加了集团的收入，同时也得到了用户的好评。

三、基于角色的访问控制

基于角色的访问控制，主要是针对营业厅营业员以及运维系统的运维人员，基于角色的访问控制可以限制营业员受理业务的范围，比如是否可以受理跨地市的业务，是否可以受理新上线的业务，是否可以给用户减免违约金，是否可以给予某种优惠等操作，一旦操作不当就有可能导致用户的投诉，给集团带来直接经济损失也会带来口碑上的下滑，不利于客户关系的维护。运维人员如果因误操作对用户数据造成不可恢复的损害，也将造成严重后果，所以需要实现“最小权限原则”和“权限分离原则”，将试图访问信息的用户只能访问执行自身角色职能所必须的那部分数据。实现基于角色的访问控制，还有一大好处就是便于对营业员和运维人员账号的维护，当员工需要某个权限的时候，只需要在该工号上配置上一条相应的角色就可以实现营业员账号权限的扩展，提供给工号管理系统的就是一个选项的按钮而已，可以以最快的时间实现营业员权限的扩展和收缩。

通过上述鉴别服务和访问控制方案的实施，该系统于`年`月完成第一个版本的顺利验收。上线后虽然出现了某些特殊用户到某个营业厅办理不了某些业务需要到指定的营业厅才能办理的场景，但是并没有发生角色越权行为，没有给集团带来经济损失。项目至今仍然保持着每月一次或者两次的版本迭代，顺利实现了1.0到2.0架构演进的平滑式过渡，得到了甲方的肯定，实践证明鉴别服务和访问控制方案适用于该项目安全架构的实现。

当然，在系统的后期运行维护过程中，也陆续发现了一些问题和不足，在服务调用链上没有做访问量控制，没有做调用链剥离，当推广的某一业务量突然上来后，会导致调用链崩溃而不可用，也会因为运维修复大量数据重跑某些业务，导致关键业务崩溃，波及实时业务。同时也导致了很多异常数据，给运维人员增加了工作量。在后续的改进方案中对重点调用链进行了剥离，并做了访问量控制。运维大批量的数据修复工作只能在晚上执行。运维人员对数据库的一切增删改查操作均需要有日志记录，并定期将该运维人员的操作日志发给该运维人员确认是否是本人操作，确保生产数据的安全性。



## 第二篇

信息安全的特征是为了保证信息的机密性、完整性、可用性、可控性和不可抵赖性。信息系统的安全保障是以风险和策略为基础，在信息系统的整个生命周期中提供包括技术、管理、人员和工程过程的整体安全，在信息系统中保障信息的这些安全特征，并实现组织机构的使命。许多信息系统的用户需要提供一种方法和内容对信息系统的技术框架、工程过程能力和管理能力提出安全性要求，并进行可比性的评估、设计和实施。

请围绕“论系统安全架构设计及其应用”论题，依次从以下三个方面进行论述。
1. 概要叙述你所参与管理或开发的软件项目，以及你在其中所承担的主要工作。
2. 详细论述系统安全架构设计涉及的主要内容，面临的主要威胁，并说明其危害。
3. 阐述你在系统安全架构设计的落地过程中通过什么手段解决了哪些问题。



通常意义上来讲，信息系统安全架构一般需要包括`五`方面要素即：`物理安全、系统安全、网络安全、应用安全和安全管理`。其中在`物理安全`方面，主要是保障信息系统硬件设备、基础设施以及其所处环境的安全，确保服务器和存储设备处于物理上受保护的状态。在此项目中，大部分应用都跑在大厂的云服务器上，因此对于云服务的物理安全和网络安全参与不多，这块服务保障主要由云服务提供商负责。在`系统安全`方面，一般重点在于保护服务器、数据库等基础软件服务，防止未经授权的访问或操作，确保系统的稳定性和数据完整性。一般来说，操作系统、数据库等未被及时修复的漏洞可能会被黑客利用。在`应用安全`方面，主要是防止第三方非法进行用户账户窃取以及通过应用漏洞或越权访问数据，这个也是笔者所带团队重点关注的方向。因为攻击者往往会利用一些常见的应用程序的漏洞，如SQL注入、跨站脚本攻击（XSS）、跨站请求伪造（CSRF）等，在用户不知情的情况下执行一些如修改用户的账户设置、发起转账等高危操作。最后，也是最容易出问题的，就是`安全管理`。笔者的个人体会是，就算你前面的策略做得再好再完善，一旦在安全管理上失守，那就相当于前功尽弃。受限于篇幅，在本文中，笔者将从自身实践出发，重点从应用安全，系统安全，安全管理等三方面展开，谈谈系统安全架构落地过程中的心得体会。


在`应用安全方面`，笔者主要关注SQL注入、跨站脚本攻击（XSS）等常规的安全漏洞防范。在笔者的理解里，SQL注入本质上是由于程序在执行SQL语句时，用户输入的数据未被妥善处理，结果这些输入意外成为执行的代码。而实际上根据笔者多年经验，这个问题通过成熟的持久层插件就可以解决。而实现的原理归结到本质就是参数化查询。通过参数化查询，我们不会把用户的输入直接拼接进SQL语句里，而是把这些输入当作参数传递给SQL引擎，让SQL引擎预先编译SQL语句，再去执行，从而避免危险代码的注入。在电商项目中涉及大量需要对外展示评论的场景，这些场景往往会被别有用心之人使用来做跨站脚本攻击。这个场景中我们一般在后端采用Java的第三方库来对用户提交到数据库中的数据进行编码，防止传到前端之后被浏览器解释为可执行的脚本。这样做的好处是一次性后端处理完毕即可，而不用前端每次都做html“杀毒”工作。

在系统安全方面，我们主要关注的是操作系统层面的安全。一般来说，用户正确的操作系统管理可以降低操作系统被攻击的风险，进而保证操作系统的安全性。笔者团队主要的工作包括操作系统流程管理、特权操作环境和基础设施管理、操作系统补丁管理等。笔者在实践中，根据不同的应用场景分配不同的账户权限，设定最小特权原则，防止管理活动和特权账户被恶意行为者破坏。例如针对Web服务器管理员，主要赋予管理和维护Web服务器（如Apache或Nginx）及其相关的应用程序和配置文件的权限。针对安全管理员，主要赋予安装和配置安全工具、查看安全日志、进行安全审计等权限。除此之外，应用安全补丁对于确保应用程序、驱动程序、操作系统和固件的持续安全性至关重要。在这过程中，出于谨慎考虑，笔者在部署补丁之前，往往要求团队成员创建一个与生产环境相似的测试环境，在测试环境中先应用安全补丁，观察系统性能、应用程序功能和兼容性，测试无误方部署上线。

在安全管理方面，安全管理是该系统必不可缺少的一个环节。安全管理是以人为主导从事安全生产工作，管得好坏在于人的意识和责任划分。依据笔者的经验，安全管理体系也是一项体系工程，目的推动参与的人系统地开展安全生产工作。体系的完善和落实到位有利于避免安全生产事故的发生和应对突发情况。在笔者公司内部，为确保信息安全管理体系的有效运行，定期会对项目的信息安全状况进行评估和审计。通过各种技术手段对系统进行实时监控，如使用入侵检测系统、日志分析工具等及时发现和响应安全事件。对系统和网络的安全等进行定期检查，如扫描、漏洞评估等，确保安全控制措施的有效性。通过这种内部的安全优化机制，不断提升我司的信息安全防护能力和管理水平。

得益于系统安全架构的落地实施，本项目的安全风险得到了较好地控制。虽经历了多次的需求变更，大大小小数十次迭代，但该项目仍然安全稳定运行至今，取得了设计之初的预期结果。`作为技术负责人，笔者也深切感受到，安全是保障和促进业务发展的`，而业务发展过程中，必然有场地的变化、人员的变化、系统的变化、流程的变化、权限的变化，所以安全的力度、粒度都需要紧紧跟随业务的变化而变化，红线（底线）以上、安全需求（上线）以下才是我们安全的发展空间。同时，随着业务竞争越来越激烈，安全风险越来越高，所以安全是一个动态的过程，我们需要持续跟进同行或外部环境并进行调整。最后，业务团队人员的变动，可能会导致我们的安全制度和措施变样。那么笔者认为这要从两个方面考虑，一个是安全团队在业务团队有专职或兼职的接口人，加强部门间的工作沟通，另一个是在业务管理过程中，融入的安全措施能够提供良好的用户体验，使得业务人员能够主动积极地拥抱安全，为安全站位。



## 第三篇


系统中运行的各公司敏感业务数据，其中不乏涉及决策层的商业信息，信息的保密尤为重要；从信息化系统的特点来看，通信方式的安全同样至关重要。针对以上情况，我首先选定了可以附加增强安全手段的多层分布式架构来提供安全与保密保障的基础可能。我根据架构特点，将安全保障方案分为物理层级和软件层级。在物理层级，我通过私有云提供的隔离手段，将各层之间通过防火墙进行了物理隔离，并在DMZ中只保留了必须的接入服务器，以最大程度的在物理层次上降低安全风险。在物理层级提供了足够的安全保障之后，系统主要的安全性和保密性设计集中在了软件层级的设计上，下面，我结合项目实际情况就软件方面所采取的防窃取、防破解、防泄露等技术手段进行详细说明。

第一，通过 HTTPS、敏感数据加密、数据不落地的方式实现了通信数据的防窃取。平台作为信息化系统，决定了数据需要从内部网络流经互联网到达终端，在内部网络到外部网络部分，通过集团私有云提供的审计能力，可以提供足够的安全保障。但是数据需要在互联网上流转，这就要求数据流转的通道必须是安全的，同时敏感信息也必须是安全加密的。通道的安全，经过论证分析，最终我们采用了 HTTPS 作为通信方式。HTTPS 技术通过在 HTTP 协议附加 SSL 的方式实现，其次对数据实行加密，数据加密即对明文按照某种加密算法进行处理，而形成难以理解的密文，按照加密密钥和解密密钥的异同，有两种密钥体制，分别是对称密码体制和非对称密码体制


对称加密体制，加密和解密采用相同的密钥，因为加密速度快，通常用来加密大批量数据，典型方法有 IDEA、DES。

非对称密码体制，加密和解密使用不同的密钥，其中一个密钥是公开的，一个是私有的，但该加密速度很慢，只适合于加密少量数据，典型的技术有 RSA。

结合项目特点，主要为商业数据，数据机密性高，同时数据也主要是一些数字和一些名称等信息，所以我们采用非对称加密的方式，作为软件设计手段，我们在客户端的设计上采用了数据不落地的形式，即所有客户端流经的数据，除了账号用于免输入以外，其他数据都不存储到客户端本地，终端的所有业务数据都从服务器获取，最大程度的避免了客户端被反编译和沙盒入侵所带来的安全风险。


第二，通过验证码、生物特征识别、锁定账户等手段防止系统入口的暴力破解。用户必须登陆后才可以使用系统功能，密码的防暴力破解成为这方面的关键点。通过调查分析，单纯的使用账户、密码方式登陆系统，可能出现面对暴力破解时的泄露问题，为了解决这个问题，我在系统的认证环节引入了验证码技术和人脸识别技术。验证码技术可以提高登陆业务的复杂程度，加大针对密码的暴力破解的难度。同时也保证只有当前正在操作的用户和手机号都符合系统匹配条件才能进入，此为第一道关，而在正式开票时，需要再进行人脸识别技术通过其生物识别技术特点，保证只有具备开票职责的人员才能使用该功能，进一步满足安全的要求。同时，我在系统中采取了密码失败多次锁定账户一定时间的机制，具体为，用户密码或输入三次，系统自动锁定账户三十分钟，这三十分钟内，该账户无法登陆系统，这就进一步加大了破解账户密码的时间，基本上可以认为这些手段屏蔽了密码暴力破解的可能。最终我选择的方式是将这三种技术手段根据场景结合使用，用户初次登陆系统时采用普通密码方式，登陆成功后，强制对核心功能模块设置人脸识别技术，并将人脸信息存储于服务端，用户后续的登陆将只能使用密码+人脸识别登陆，密码三次错误锁定账号的机制则贯穿两种登陆方式，既满足了系统的易用性，又提高了登陆的安全性。

综合使用了如上的硬件和软件安全技术手段之后，平台于2015年末顺利通过了安全部门的安全检测正式上线，至今已稳定运行了接近2年时间，运行过程中未发生过一起安全事故。系统所采用的通信防窃取、防暴力破解、密码防泄露等技术手段发挥了重要的作用，获得了领导和同事的好评。但是在系统运行过程中，我也发现了技术手段存在的一些不足。首先是单纯的HTTPS通信并未将信道进行有效隔离，可以考虑增加VPN或VPDN的手段实现。其次是密码摘要的盐采用了用户账号，使得盐固化到了客户端，有一定的安全风险，可以采用客户端验密时先从服务端获取与账号不同的盐，再进行严验密的方式解决。以上这些问题将是我以后在安全架构设计上需要重点考虑的问题。



















































