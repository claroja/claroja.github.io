# 论面向服务架构设计及其应用



## 题目

面向服务架构（Service Oriented Architecture，SOA）是一种应用框架，将日常的业务应用划分为单独的业务功能服务和流程，通过采用良好定义的接口和标准协议将这些服务关联起来。通过实施基于 SOA 的系统架构，用户可以构建、部署和整合服务，无依赖应用程序及其运行平台，从而提高业务流程的灵活性，帮助企业加快发展速度，降低企业开发成本，改善企业业务流程的组织和资产重用。

请围绕“面向服务架构设计及其应用”论题，依次从以下 3 个方面进行论述。
1. 概要叙述你参与分析和开发的软件系统开发项目，以及你在其中所担任的主要工作。
2. 说明面向服务架构的主要技术和标准，详细阐述每种技术和标准的具体内容。
3. 详细说明你所参与的软件系统开发项目中，构建面向服务架构时遇到了哪些问题，具体实施效果如何。



## 正文


`SOA`将应用程序的不同功能单元（服务）通过它们之间定义良好的接口和契约联系起来，使得它们可以以一种统一和通用的方式进行交互，构建完整的业务功能。接口采用中立的方式来定义，独立于实现服务的硬件平台、操作系统、编程语言等。SOA与单体服务架构相比，最大的不同的是：SOA包含多个服务，并以协作的方式提供完整的服务，具有灵活性高、降低产品成本、易于重构的优点。因此SOA更适合构建现代应用服务程序。

SOA最基本的协议和规范包括`三个`部分，概括如下：
1、`UDDI`规范。UDDI是一套基于Web的、分布式的、为Web服务提供的信息注册中心的实现标准规范。担当UDDI注册中心可以是任意一个存储组件，例如MySQL、zookeeper、redis等，但在具体实现时需要符合完整的UDDI规范，例如服务描述需要数据模型概览、商业实体信息、技术绑定信息、元技术信息等服务必要属性。
2、`WSDL`规范。WSDL 规范是一个用来描述Web Service和说明如何与Web Service通信的XML文档。文档中使用一系列主要元素描述了Web Service的三个基本属性：服务提供的操作（方法）、和服务交互的数据格式以及必要协议、协议相关的地址（如URL）。
3、`SOAP`协议。SOAP是在分散式或环境中交换信息的简单协议，是一个基于XML + HTTP的协议。它提供了一种标准方法，使得运行在不同的操作系统并使用不同的技术和编程语言的应用程序可以互相通信。
4、Web Service。Web Service是目前SOA的最主要的服务提供者实现方式。它基于HTTP + XML两个关键规范带来众多优点，比如无状态、接口明确、自包含、模块化、松耦合、可重用能力、高扩展性和高伸缩性等。✨纯讲理论

`在项目之初，我充分认识到该项目的特点和挑战`：由于业主方是一个广受欢迎的白酒品牌，可以预见到电子商城APP一旦发布，原价销售的策略会引来海量的用户注册、登陆、抢购，因此甲方公司对于整体系统性能要求极高。然而作为商城项目要集成多个物流公司、支付公司和销售部门的核心系统，这些单位的每个系统架构风格不一样，编程语言也不一样，并且已有多数单位已经将自己的业务封装成了对外的服务。这就要求商城项目需要在它们的基础上，选用成熟的架构风格来进行服务整合和服务集成，确保项目总体架构的稳定性。我带着架构组经过严格的考察和论证，最终选用SOA的服务注册表模式来架构整个商城项目。✨将理论实践结合单开一段

一、`业务系统`服务化。公司内的各部门可能都有自己的一套系统，并且各自使用了独有的编程语言、运行环境等，如果不做改造，集成这些业务系统有很大困难。为了能够有效整合和利用公司内部的业务系统，由我牵头、各部门配合一起将所有部门业务系统构建成为WebService。由于WebService的自包含特点，业务本身采用原来的编程语言，而代码风格、网络特征几乎可以不用改变，业务组织部门也无需调整，仅仅是在原有的基础上扩展了网络 HTTP 的端口，所以避免了重构带来的巨大工作量。业务系统的服务化，为后面的服务集成打下了坚实的基础。

二、`服务的注册和整合`。服务的注册是服务整合的关键，也是系统高可靠性的保证。无论是商城平台的交易撮合服务、对账服务、清算服务，或是支付公司的收单服务、记账服务，或是银行系统资金结算服务，都已被封装成Web Service，用来支撑和实现商城平台的完整功能。用户的每一笔交易，不同时刻需要访问不同的服务，因此需要有一个服务注册构件，来承担服务注册交互UDDI的角色。架构组选型了 zookeeper三点高可用集群作为服务注册表，提供了服务信息“集散地”的功能。当需要使用什么服务，就来这里查询一下，得到服务的位置、描述、方法等，进而去调用它，最终达到服务整合的目标。使用了SOA的架构风格，使得商城平台的系统伸缩性和服务可靠性大大提升。当支付流量增大时，可以增加部署某个服务的实例，并注册到zookeeper中，增加系统的并行度。当某个服务实例出现问题时，利用心跳和异常反馈，动态从zookeeper中删掉该服务实例，保证了从整体上的系统访问可用性。

三、`使用统一的SOAP协议`。根据SOAP协议的规范，每个服务需要遵循HTTP+RESTFUL+XML描述作为网络协议和传输格式。因此在我的主导下，根据商城的业务特点，在遵循SOAP规范下制定了一整套服务接口，并协调各部门各系统共同遵循。为了应用层使用的便利性，统一封装了服务访问的SDK构件，制定了服务访问间的细则约束。针对外部单位已有但无法遵循SOAP规范的依赖服务，采取适配器的设计方式进行协议的转换，最大化保证在系统边界内部保持纯粹的面向服务的架构体系，为未来带来比较大的伸缩性。

四、`服务的访问质量`。服务的访问质量，将决定集成系统整体的质量。自项目成立之初，就把系统的性能、可用性视为关键质量属性。在性能方面，力争“用户支付时在50ms内得到结果”，否则就会影响用户体验。项目组在应用层采用基于HTTP和XML的SOAP简单信息交换协议，在存储层采用分布式数据库，在接入层采用多节点接入以及多个机房的建设，保证了性能方面的需求。在可用性方面，应用层采用负载均衡技术，来动态策略调整请求的分发，自动断流并踢出出现故障的服务器，存储层则采用MySQL主从集群的架构，在主库出现问题时能够自动主备切换。

综合运用了上述的各项基于SOA的架构方法和实现，得到了一个与商城业务非常匹配、合理的系统架构，输出了一份4+1架构视图。在详细设计阶段，比较顺利地实现了前期需求分析的所有功能点和性能要求，保障了接下来系统实现、测试、验收等工作的实施。在最近的双11和618等场景下，经受了秒杀的性能考验。这也充分说明了在当今信息系统建设中，SOA是应对整合复杂业务的一项重要手段。





















