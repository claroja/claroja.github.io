# 层次分析法(AHP)

层次分析法（Analytic Hierarchy Process, AHP），由美国运筹学家托马斯·L·萨蒂（Thomas L. Saaty）在20世纪70年代提出。该方法通过将复杂问题分解为层次结构，将定性判断与定量分析相结合，为决策者提供系统化的分析工具。

## AHP的基本原理与核心思想

AHP的理论根基建立在三个核心原理之上：

- 分解原理：将一个复杂、非结构化的决策问题拆解成若干个更小、更易于管理的组成部分，并按内在逻辑关系组织成自上而下的层次结构模型。这种结构通常包括目标层、准则层和方案层。
- 比较原理：在层次结构的每一层中，决策者需要将同层级元素两两配对比较，依据上一层级的某个准则，判断元素间相对重要性（或优劣、可能性等），并使用1-9标度法量化这种比较结果。
- 综合原理：将各层次的权重和优先级进行整合，最终得出全局的评估结果。这一过程确保了所有局部判断被系统性地聚合，形成整体决策依据。

## AHP方法的实施步骤详解

AHP的应用过程可以分为五个系统化步骤。

### 步骤一：建立层次结构模型

一个典型的层次结构包含三个主要层次：

- 目标层：位于层次结构的顶端，代表决策的总体目标，通常只有一个元素。
- 准则层：连接目标与方案的桥梁，包含评估备选方案的各种标准和指标。准则层可以进一步细分为子准则层，以更精细地描述决策标准。
- 方案层：由待评价或选择的备选方案组成，是层次结构的最底层。

🌰例如在选择笔记本电脑时，目标层是"选择最合适的笔记本电脑"；准则层可包括性能、便携性、价格、品牌等因素；方案层则是具体的笔记本型号。

🌰再比如选择旅游地的例子，目标层是"选择最佳旅游地"，准则层可包括景色、费用、居住、饮食、旅途等因素，方案层则是具体的旅游地点如苏州、杭州、桂林等。

### 步骤二：构造判断矩阵

在这一步骤中，需要对同一层次内的各元素，以上一层某一准则为基准，进行两两重要性比较。比较结果采用Saaty提出的1-9标度法表示，该标度法通过心理学研究证实符合人类判断的特点。1-9标度法的具体含义如下表所示：

| 标度   | 含义                                       |
| ------ | ------------------------------------------ |
| 1      | 两因素相比较，同等重要                     |
| 3      | 两因素相比较，一因素比另一因素稍微重要     |
| 5      | 两因素相比较，一因素比另一因素明显重要     |
| 7      | 两因素相比较，一因素比另一因素重要得多     |
| 9      | 两因素相比较，一因素比另一因素极端重要     |
| 2,4,6,8 | 为以上标度的中间状态                       |
| 倒数   | 若因素i与j比较得aij，则因素j与i比较得1/aij（互反性） |

🌰以旅游地选择为例，专家对准则层构建的判断矩阵可能如下：

- 景色与费用相比稍微重要（标度3）
- 景色与饮食相比明显重要（标度5）
- 费用与饮食相比稍微重要一些（标度2）

对应的判断矩阵为：

|        | 景色 | 费用 | 饮食 |
| ------ | ---- | ---- | ---- |
| 景色   | 1    | 3    | 5    |
| 费用   | 1/3  | 1    | 2    |
| 饮食   | 1/5  | 1/2  | 1    |

判断矩阵具有正互反性，即若A对B的重要性为a，则B对A的重要性为1/a。在实际操作中，判断矩阵的构建通常基于专家调查或决策者的主观判断。

### 步骤三：计算权重向量

构建判断矩阵后，下一步是计算各元素的相对权重，即确定它们在对应准则下的重要性排序。计算权重的方法主要有和积法（算术平均法） 和方根法（几何平均法）。

#### 和积法（算术平均法）

和积法是一种常用的权重计算方法，步骤如下：

1. 将判断矩阵按列归一化：

    $$
    b_{ij}=\frac{a_{ij}}{\sum_{k=1}^n a_{kj}}
    $$

2. 对归一化后的矩阵按行求算术平均值，得到权重向量：

    $$
    w_i = \frac{1}{n} \sum_{j=1}^{n} b_{ij}
    $$

🌰以旅游地选择案例中的判断矩阵为例：

$$
A = \begin{bmatrix} 1 & 3 & 5 \\ 1/3 & 1 & 2 \\ 1/5 & 1/2 & 1  \end{bmatrix}
$$

1. 将判断矩阵按列归一化：

    - 第一列求和: 1 + 1/3 + 1/5 ≈ 1.533
        - $b_{11}=1/1.533≈0.652$
        - $b_{21}=0.333/1.533≈0.217$
        - $b_{31}=0.2/1.533≈0.130$
    - 第二列求和: 3 + 1 + 0.5 = 4.5
        - $b_{12}=3/4.5≈0.667$
        - $b_{22}=1/4.5≈0.222$
        - $b_{32}=0.5/4.5≈0.111$
    - 第三列求和: 5 + 2 + 1 = 8
        - $b_{13}=5/8=0.625$
        - $b_{23}=2/8=0.250$
        - $b_{33}=1/8=0.125$
    - 得到归一化矩阵:

        $$
        B = \begin{bmatrix} 0.652 & 0.667 & 0.625 \\ 0.217 & 0.222 & 0.250 \\ 0.130 & 0 111 & 0.125 \end{bmatrix}
        $$

2. 对归一化后的矩阵按行求算术平均值，得到权重向量：

    - $w_1=(0.652+0.667+0.625)/3≈0.648$
    - $w_2=(0.217+0.222+0.250)/3≈0.230$
    - $w_3=(0.130+0.111+0.125)/3≈0.122$
    - 得到权重向量: $[0.648, 0.230, 0.122]$

#### 方根法（几何平均法）

方根法是通过计算判断矩阵各行元素的几何平均值，再进行归一化处理得到权重向量的方法。计算步骤如下：

1. 计算判断矩阵每行元素的几何平均值：

    $$
    g_i = \sqrt[n]{\prod_{j=1}^{n} a_{ij}}
    $$

2. 对几何平均值进行归一化处理，得到权重向量：

    $$
    w_i=\frac{g_i}{\sum_{k=1}^n g_k}
    $$

🌰以旅游地选择案例中的判断矩阵为例:

$$
A = \begin{bmatrix} 1 & 3 & 5 \\ 1/3 & 1 & 2 \\ 1/5 & 1/2 & 1  \end{bmatrix}
$$

1. 计算判断矩阵每行元素的几何平均值：

    - 景色: $g_1 = \sqrt[3]{1 \times 3 \times 5} = \sqrt[3]{15} \approx 2.466$
    - 费用: $g_2 = \sqrt[3]{1/3 \times 1 \times 2} = \sqrt[3]{2/3} \approx 0.874$
    - 饮食: $g_3 = \sqrt[3]{1/5 \times 1/2 \times 1} = \sqrt[3]{0.1} \approx 0.464$

2. 对几何平均值进行归一化处理，得到权重向量：

    - 总和: 2.466 + 0.874 + 0.464 ≈ 3.804
    - $w_1=2.466/3.804≈0.648$
    - $w_2=0.874/3.804≈0.230$
    - $w_3=0.464/3.804≈0.122$
    - 得到权重向量: $[0.648, 0.230, 0.122]$

### 步骤四：一致性检验

由于判断矩阵基于主观判断构建，可能存在逻辑不一致的情况。例如，若A比B重要，B比C重要，从逻辑上讲A应该比C重要，但判断矩阵中可能出现相反的情况。为评估判断矩阵的一致性，AHP方法引入了一致性检验机制。一致性检验的步骤如下：

1. 计算一致性指标CI（Consistency Index）：

    $$
    CI=\frac{\lambda_{max} - n}{n-1}
    $$


    其中$\lambda$为判断矩阵的最大特征值，$n$为矩阵阶数。

2. 查询随机一致性指标RI（Random Index），与矩阵阶数相关：


    | n  | 1 | 2 | 3   | 4    | 5    | 6    | 7    | 8    | 9    | 10   |
    |----|---|---|-----|------|------|------|------|------|------|------|
    | RI | 0 | 0 | 0.58 | 0.90 | 1.12 | 1.24 | 1.32 | 1.41 | 1.45 | 1.49 |

3. 计算一致性比率CR（Consistency Ratio）：

    $$
    CR=\frac{CI}{RI}
    $$


    当$CR < 0.1$时，认为判断矩阵的一致性可接受；若$CR ≥ 0.1$，则需要调整判断矩阵。


🌰以前述旅游地选择案例为例：

计算最大特征值$\lambda_{max}$:

$$
A \cdot w = \begin{bmatrix}
1 & 3 & 5 \\
1/3 & 1 & 2 \\
1/5 & 1/2 & 1
\end{bmatrix} \cdot \begin{bmatrix}
0.648 \\
0.230 \\
0.122
\end{bmatrix} = \begin{bmatrix}
1 \times 0.648 + 3 \times 0.230 + 5 \times 0.122 \\
1/3 \times 0.648 + 1 \times 0.230 + 2 \times 0.122 \\
1/5 \times 0.648 + 1/2 \times 0.230 + 1 \times 0.122
\end{bmatrix} \approx \begin{bmatrix}
1.948 \\
0.69 \\
0.367
\end{bmatrix}
$$


$$
\lambda_{\max} = \frac{1}{n} \sum_{i=1}^{n} \frac{(A \cdot w)_i}{w_i} = \frac{1}{3} \left( \frac{1.948}{0.648} + \frac{0.69}{0.230} + \frac{0.367}{0.122} \right) = \frac{1}{3} (3.006 + 3 + 3.008) \approx 3.005
$$

计算CI、CR值：
$$
CI=\frac{3.005-3}{3-1}=0.0025
$$

$$
CR=\frac{0.0025}{0.58}≈0.0043<0.1
$$

通过了一致性检验。


### 步骤五：层次总排序与决策

完成各层次单排序和一致性检验后，需要进行层次总排序，即计算各方案对总目标的相对权重。这一过程是从上至下进行的，将上层元素的权重与下层元素的局部权重相乘累加，得到最终的综合权重。


层次总排序也需要进行一致性检验，确保整体判断的一致性。总排序一致性比率计算公式为：

$$
CR_{\text{总}} = \frac{\sum_{j=1}^{m} a_j CI_j}{\sum_{j=1}^{m} a_j RI_j}
$$

其中：

- $a_j$为准则层第$j$个元素的权重
- $CI_j$为方案层对准则$j$的判断矩阵的一致性指标
- $RI_j$为方案层对准则$j$的判断矩阵的随机一致性指标

当$CR_{\text{总}} < 0.1$时，认为层次总排序的一致性可接受。


## 参考

- https://cloud.tencent.com/developer/article/2566610
- https://blog.csdn.net/mmm_jsw/article/details/84863416




