# 点估计

通过样本的参数来估算总体的参数. 比如使用样本的均值统计量, 估算总体的平均值.

## 总体均值的点估计
随机抽取20个人的考试分数, 可以看做一个相互独立的随机变量$X_1,...,X_n$服从期望为$\mu$, 方差为$\sigma^2$的概率分布. 然后从这些样本中计算出的样本平均值$\overline{X}=\frac{X_1,...,X_n}{n}$也是随机变量, 每次试验的结果都不一样.
```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from scipy import stats

## 总体
scores = [76,55,80,80,74,61,81,76,23,80,41,80,68,88,69,57,68,86,70,68,81,73,70,90,93,79,66,92,88,81,52,72,59,68,74,72,63,89,45,81,42,76,57,83,71,74,55,60,73,79,100,73,85,47,50,65,52,92,64,91,92,71,78,69,78,77,68,78,96,81,75,72,55,55,75,49,59,89,
99,45,94,67,70,68,86,46,77,56,79,93,70,76,76,58,93,96,81,71,63,61,96,91,69,46,28,54,68,91,60,78,90,72,68,50,52,76,67,72,69,80,58,65,98,58,66,61,77,85,63,64,66,78,59,64,34,49,68,83,74,54,49,73,45,86,71,46,56,59,58,48,57,60,59,87,72,
55,65,57,65,83,74,100,76,56,82,86,86,54,68,87,45,63,49,56,55,89,66,57,54,72,70,90,78,49,61,86,61,96,54,79,57,62,86,68,82,77,81,57,67,76,57,94,58,65,55,38,97,67,63,67,91,56,80,64,61,79,85,62,58,52,87,61,42,91,49,82,73,74,61,75,45,79,93,83,40,55,67,77,68,63,79,87,67,81,31,56,65,63,75,85,78,61,47,78,42,80,67,52,74,70,69,69,76,84,77,85,69,94,79,62,54,73,50,55,74,61,56,69,71,67,64,83,75,67,100,
73,87,62,50,58,66,63,90,68,77,69,63,71,96,58,82,55,63,70,75,92,69,57,80,65,74,68,41,78,79,84,97,52,78,76,64,76,77,52,74,56,60,43,63,67,78,70,47,83,68,77,84,91,99,69,75,54,86,52,43,82,62,82,76,46,29,54,70,52,60,48,73,71,63,91,92,78,43,53,76,61,63,83,78,90,64,91,62,92,72,57,46,65,66,83,68,64,86,67,61,79,63,80,61,67,72,64,70,82,76,77,60,83,80,85]

p_mean = np.mean(scores)
p_var = np.var(scores)

p_mean, p_var  # (69.530, 206.669)

## 抽样
n = 20  # 每组样本有20个样本
np.random.seed(1111)
n_samples = 10000  # 10000组样本
samples = np.random.choice(scores, (n_samples, n))  # 10000组样本容量为20的样本数据.

for i in range(5):
    s_mean = np.mean(samples[i])
    print(f'第{i+1}次的样本平均值: {s_mean:.3f}')

"""
第1次的样本平均值: 67.000
第2次的样本平均值: 72.850
第3次的样本平均值: 69.200
第4次的样本平均值: 64.450
第5次的样本平均值: 72.650
"""
```

使用大数定律来确认样本平均值$\overline{X}$的期望值为总体平局值$\mu$. 对前面已经准备好的10000组样本数据分别计算样本均值, 再计算其平均值:

```python
sample_means = np.mean(samples, axis=1)
np.mean(sample_means)  # 69.538
```
总体均值为69.530, 样本平均值的期望值是总体平均值.

1. 无偏性

    每个样本平均值$\overline{X}$期望值(平均值的平均值)与与总体均值保持一致, $E(\overline{X})=\mu$ .估计量的期望值与想要估计的总体相一致的性质被称为`无偏性(unbiasedness)`, 且具有无偏性的估计量被称为`无偏估计量(unbiased estimator)`. 这里样本平均值能很好地估计总体平均值的理论依据之一就是无偏性.

2. 一致性

    除了无偏性, 还有`一致性(consistency)`, 即随着样本容量$n$的增加, 样本平均值会收敛到总体平均值. 具有一致性的估计量被称为`一致估计量(consistent estimator)`. 样本均值就是一致估计量, 下面看样本容量$n$达到100万时样本平均值$\overline{X}$.

    ```python
    np.mean(np.random.choice(scores, int(1e6)))  # 69.543
    ```

因为样本平均值具有无偏性和一致性, 所以可以很好的推断出总体的平均值


## 总体方差的点估计

与样本平均值相同, 样本方差$\frac{1}{n}\sum_{i=1}^n(X_i-\overline{X})^2$也是一个随机变量, 所以每次试验结果都会发生变化.

```python
for i in range(5):
    s_var = np.var(samples[i])
    print(f'第{i+1}次的样本方差: {s_var:.3f}')
"""
第1次的样本方差: 116.800
第2次的样本方差: 162.928
第3次的样本方差: 187.060
第4次的样本方差: 149.148
第5次的样本方差: 111.528
"""

```
用大数定律来确认样本方差是否是总体方差的无偏估计量. 对准备好的10000组样本数据分别计算方差, 并取其平均值:

```python
sample_vars = np.var(samples, axis=1)
np.mean(sample_vars)  # 196.344
```

与总体方差$\sigma^2=206.669$相比, 样本方差数值较小. 看来`样本方差并不是总体方差的无偏估计量`.

那么就需要使用`无偏方差(unbiased variance)`来估算, 把样本方差中的$n$换为$n-1$. 样本方差$S^2$表示, 无偏方差用$s^2$表示:

$$
s^2 = \frac{1}{n-1}\sum_{i=1}^n(X_i-\overline{X})^2
$$

这里除数$n-1$是一个被称为`自由度(degree of freedom)`的值, 表示可以自由取值的变量的个数. 对于样本平均值, 式中的$\sum_{i=1}^nX_i$没有任何限制, 每个$X_i$都可以自由取值, 所以自由度为$n$. 但是对于方差, 公式中$\sum_{i=1}^n(X_i-\overline{X})^2$的每个$X_i$都需要满足$\frac{1}{n}\sum_{i=1}^nX_i=\overline{X}$这个条件, 因此自由度要减少1个变成$n-1$.


> 正是因为在求样本方差时，要用到样本的均值（用以估计总体均值），才导致了一个自由度的损失。而计算总体的时候，你并不需要计算均值，因为你用，或者不用，均值就在那里，不需要你算。


> 你只取了3个数1,5,9。因为你不知道 $\mu$ ，你无法估计1,5,9相对 $\mu$ 的波动，但你可以计算他们自己内部的波动程度呀，也就是相对他们自己的期望 $\bar{X}$ 的波动程度。所以你就用（1+5+9）/3 = 5这个期望来估算总体的波动。
> 
> 但有意思的事情来了，你这3个数有几个毫不相干的波动呢？已知期望是5,第一个波动是 $(1-5)^2$第二个波动是$(5-5)^2$第三个波动是……等等，因为你知道期望是5了，你一个是1,第二个是5,第三个必然是9,那第三个波动必然是$(9 - 5)^2$ ,这个是可以由前两个波动和自己的均值推出来的。所以，你真正毫不相干的波动只有2个，所以你的自由度，是3-1 = 2换句话说，你取了3个数，但只看到2个有统计意义的波动。

1. 无偏性

    在Numpy中, 可以通过把var函数的ddof参数指定位1来计算无偏方差. 和样本方差一样, 可以使用大数定律确认无偏方差的期望值:

    ```python
    sample_u_vars = np.var(samples, axis=1, ddof=1)
    np.mean(sample_u_vars)  # 206.678
    ```

    这个值解决总体方差的真值, `无偏方差是总体方差的无偏估计量`.

2. 一致性

    `无偏方差也是总体方差的一致估计量`, 将样本容量设置为100万进行确认:

    ```python
    np.var(np.random.choice(scores, int(1e6)), ddof=1)  # 207.083
    ```


接近总体方差的一致估计量. 相对于总体方差, 无偏方差具有无偏性和一致性.


## 点估计总结
估计量最好具有无偏性和一致性:
1. 统计量的期望值正好是想要推断的总体的性质
2. 随着样本容量的增加, 统计量可以收敛到想要推断的总体的性质.



参考:
- [样本方差的自由度是n-1，为何总体的自由度就是n](https://www.zhihu.com/question/36524138)