# 配对样本的t检验

### 配对样本的t检验
`配对样本t检验(paired t-test)`是对配对样本平均值差异的检验(假定平均值差异服从正态分布时)这个检验可以用于:

- 对同一个研究对象给与两种不同的处理结果
- 对同一个研究对象的试验前后效果进行比较

原理就是: 两个样本的均值应该相等, 他们相互间的均值的差或者差的均值服从正态分布.

检验步骤如下:
1. 提出假设
    - 原假设$H_0: \mu=\mu_{1}=\mu_{2}$
    - 被选假设$H_1: \mu_{1} \neq \mu_{2}$

2. 建立检验统计量. 设两个总体$X$和$Y$都服从正态分布, 两个样本之差$d \sim N(\mu,\sigma^2)$


最近A同学的班级有人说锻炼肌肉可以提高注意力. A同学不太相信, 他想在自己开始锻炼肌肉前, 先确认一下锻炼肌肉是否真的对提高注意力有效果. 因此, A先请了20位朋友做了一周肌肉锻炼, 并在此前后对他们进行了注意力测试.

```python
import pandas as pd
df = pd.DataFrame(
    {
        "前":[59,52,55,61,59,45,55,49,49,52,51,57,54,51,52,52,57,49,52,46],
        "后":[41,63,68,59,84,37,60,52,68,70,57,65,51,38,54,58,73,65,54,48]
    }
)
```

对于肌肉锻炼是否有提高注意力的效果, 我们可以从比较肌肉锻炼前和肌肉锻炼后的注意力测试的平均分得知. 用$\mu_{before}$表示肌肉锻炼前注意力测试的平均分, $\mu_{after}$表示肌肉锻炼后注意力测试的平均分, 考虑进行以下假设检验, 这样的检验是对平均值之差的检验.

1. 零假设: $\mu_{after}-\mu_{before} = 0$
2. 备选假设: $\mu_{after}-\mu_{before} \neq 0$

因为这里的数据是配对的, 所以可以根据各个数据来考虑差异:

```python
training_rel['差'] = training_rel['后'] - training_rel['前']
training_rel.head()
"""
	前	后	差
0	59	41	-18
1	52	63	11
2	55	68	13
3	61	59	-2
4	59	84	25
"""
```

如果肌肉锻炼对注意力测试没有影响, 那两者间差异应该是随机的, 平均值为0的分布. 因此, 也可以说这个假设检验是对差的平均值$\mu_{diff}$做检验, 即:

- 零假设: $\mu_{diff} = 0$
- 备选假设: $\mu_{diff} \neq 0$

而且, 如果假定这些差异分别独立地服从同一正态分布, 则该检验可以归入总体方差未知的情况下, 正态分布的总体平均值的检验, 即单样本t检验.
若知道了这一点, 操作起来就很简单了. 单样本的t检验可以用`scipy.stats`的`ttest_lsamp`函数计算:

```python
t, p = stats.ttest_1samp(training_rel['差'], 0)
p  # 0.040
```

因为p值低于显著性水平, 所以拒绝零假设. 看来肌肉锻炼会对注意力产生显著的影响.

> 一般的$H_0$假设都是假设一般的情况, 比如没有变化. 如果$p \le \alpha$即p值低于显著性水平, 说明假设对象有显著性影响

这里根据diff进行了假设检验, 若使用ttest_rel函数, 则可以用before和after的数据进行同样的检验. 因为不用特意的求差值, 所以在进行试验数据检验时, 这个函数可能会比较方便.

```python
t, p = stats.ttest_rel(training_rel['后'], training_rel['前'])
p  # 0.040
```