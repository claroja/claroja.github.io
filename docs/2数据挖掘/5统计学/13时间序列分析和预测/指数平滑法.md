# 指数平滑法

使用指数平滑方法生成的预测是过去观测值的加权平均值，并且随着过去观测值离预测值距离的增大，权重呈指数型衰减。换句话说，观察值越近，相应的权重越高。


三种常见的指数平滑方法：
- Exponential smoothing：针对「没有趋势和季节性」的序列, 一次指数平滑，从最邻近到最早的数据点的权重呈现指数型下降的规律。

- Holt exponential smoothing：针对「有趋势但没有季节性」的序列, 二次指数平滑，通过引入一个额外的系数来解决指数平滑无法应用于具有趋势性数据的问题。

- Holt-Winters exponential smoothing：针对「有趋势且有季节性」的序列, 三次指数平滑，通过再次引入一个新系数的方式同时解决了 Holt exponential smoothing 无法解决具有季节性变化数据的不足。


## Exponential smoothing
$$
s_i = \alpha x_i + (1 - \alpha) s_{i-1}, 0 \leq \alpha \leq 1
$$

其中$x_i$表示时间序列第$i$时间点对应的观测值，$s_i$表示第$i$个时间点平滑后的值；衰减因子$\alpha$可以控制对历史数据的遗忘程度，当$\alpha$接近 1 时表示只保留当前时间点的值。

展开它的递推关系式：
$$
s_i = \alpha x_i + (1 - \alpha) s_{i-1} \\
= \alpha x_i (1 - \alpha)[\alpha x_{i-1} + (1 - \alpha) s_{i-2} ] \\
= \alpha x_i (1 - \alpha)[\alpha x_{i-1} + (1 - \alpha)[\alpha x_{i-2} + (1-\alpha)s_{i-3}]] \\
= \alpha[x_i + (1 - \alpha) x_{i-1} + (1 - \alpha)^2 x_{i-2} + (1 - \alpha)^3 s_{i-3}] \\
= ... \\
= \alpha \sum_{j=0}^i (1 - \alpha)^j x_{i-j}

$$

在指数平滑法中，所有先前的观测值都对当前的平滑值产生了影响，但它们所起的作用随着参数$\alpha$的幂的增大而逐渐减小。那些相对较早的观测值所起的作用相对较小。

指数平滑考虑所有历史观测值对当前值的影响，但影响程度随时间增长而减小。对应的时间序列预测公式：

$$
\hat{x}_{i+h} = s_i
$$

其中$x_i$表示最后一个时间点对应的值；$h=1$表示下个预测值。


## Holt exponential smoothing
指数平滑考虑的是数据的`baseline`，二次指数平滑在此基础上将`趋势`作为一个分量考虑。

趋势，即斜率定义：$b = \Delta y / \Delta x$，其中$\Delta x$为$x$坐标轴的变化值。指数平滑考虑的是数据的baseline，二次指数平滑在此基础上将趋势作为一个额外考量，保留了趋势的详细信息。即我们保留并更新两个量的状态：平滑后的信号和平滑后的趋势。公式如下：
$$
s_i = \alpha x_i + (1 - \alpha)(s_{i-1} + t_{i-1}) \\
t_i = \beta(s_i - s_{i-1} + (1 - \beta)t_{i-1})
$$

第二个等式描述了平滑后的趋势。当前趋势的未平滑“值”（$t_i$）是当前平滑值（$s_i$）和上一个平滑值（$s_{i-1}$）的差；也就是说，当前趋势告诉我们在上一个时间步长里平滑信号改变了多少。要想使趋势平滑，我们用一次指数平滑法对趋势进行处理，并使用参数$\beta$（理解：对$t_i$的处理类似于一次平滑指数法中的$s_i$，即对趋势也需要做一个平滑，临近的趋势权重大）。

若要利用该计算结果进行预测，就取最后那个平滑值，然后每增加一个时间步长就在该平滑值上增加一次最后那个平滑趋势：
$$
x_{i+h} = s_i + ht_i
$$

## Holt-Winters exponential smoothing

当一个序列在每个固定的时间间隔中都出现某种重复的模式，就称之具有季节性特征，而这样的一个时间间隔称为一个季节(理解：比如说在一个周内，销量呈现出重复的模式)。一个季节的长度k为它所包含的序列点个数。

二次指数平滑考虑了序列的baseline和趋势，三次就是在此基础上增加了一个季节分量。类似于趋势分量，对季节分量也要做指数平滑。比如预测下一个季节第3个点的季节分量时，需要指数平滑地考虑当前季节第3个点的季节分量、上个季节第3个点的季节分量...等等。详细的有下述公式(累加法)：

$$
s_i = \alpha(x_i - p_{i-k}) + (1 - \alpha)(s_{i-1} + t_{i-1})  \\
t_i = \beta(s_i - s_{i-1}) + (1 - \beta)t_{i-1} \\
p_i = \gamma(x_i - s_i) + (1 - \gamma)p_{i-k}
$$

其中, $p_i$是指`周期性`部分, 预测部分如下:
$$
x_{i+h} = s_i + h t_i + p_{i-k+h}
$$

其中$k$是这个周期的长度





## 参考

- [【时间序列】Holt-Winters 指数平滑方法及其 Python 实践](https://blog.csdn.net/qq_33431368/article/details/119769361)
- [时间序列分析之指数平滑法（holt-winters及代码）](https://zhuanlan.zhihu.com/p/43353740)