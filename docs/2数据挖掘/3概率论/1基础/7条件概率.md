# 条件概率

感冒分为流感(病毒引起)和非流感(非病毒引起). 
定义事件:
1. A: 表示得流感, $\overline{A}$: 非流感
2. B: 表示高热, $\overline{B}$: 非高热
医院的感冒科室统计历史的患者得出有60%的概率会患流感, 40%为非流感. 我们可以估算在近来的1000位患者中，估计有600人所患的是流感。图中红色表示流感.
[](./条件概率/100.png)
接下来假设，医学研究表明：
1. 一方面，一个`流感的患者`持续`高热`的概率为90%，那么在600个流感患者中，估计有540人持续`高热`, 图中红色表示流感600人, 蓝色表示高热, 二者重合的部分就是既有`流感`又`高热`的占红色区域的90%, 即600*0.9=540人
[](./条件概率/200.png)
2. 另一方面，一个`非流感的患者`持续`高热`的概率为1%，那么在400个`非流感`型感冒患者中，估计有4人持续`高热`。
[](./条件概率/300.png)
我们可以算出其中544(600x0.9+400x0.1)个患者是具有典型流感症状(高热)的感冒患者。
[](./条件概率/400.png)
综合上述信息, 做出全局图来说明:
[](./条件概率/600.png)

## 全局概率
全局概率是指分母是全局的概率, 样本空间是$\Omega$, 这里是所有的1000人, 所以分母都是1000.
1. $P(A)$表示某人患流感的`全局概率`, (540+60)/1000 = 0.6
2. $P(B)$表示持续高热的`全局概率`, (396+4)/1000 = 0.4
3. $P(AB)$表示患有流感且高热的`全局概率`, 540/1000=0.54
8. $P(A\overline{B})$表示患有流感且非高热的`全局概率`, 60/1000=0.06
9. $P(\overline{A}B)$表示非流感且高热的`全局概率`,4/1000=0.004
10. $P(\overline{AB})$表示非流感且非高热的`全局概率`, 396/1000=0.396

注意这里$P(AB) \neq P(A)*P(B)$, 因为二者不独立.
## 局部概率(条件概率)
1. $P(B|A)$表示患有流感前提下, 初选持续高热的`条件概率`
$$
P(B|A) = \frac{P(AB)}{P(A)} = 540/(540+60)=0.9
$$
1. $P(A|B)$表示观察到患者高热症状的前提下, 患有流感的`条件概率`, 
$$
P(A|B) = \frac{P(AB)}{P(B)} = 5540/(540+4)=0.99
$$


## 总结
两者最重要的区别是：
- $P(AB)$也是以$\Omega$为样本空间，这是一个全局的空间，包含所有的人
- $P(A|B)$是以$B$为样本空间，相对而言是一个局部空间，仅包含了有发热症状的人

$$
\begin{array}{c|c}
    \hline
    \\
    \quad P(AB)\quad&\quad AB同时发生的概率\quad\\
    \quad P(B|A)\quad&\quad A发生条件下B发生的概率\quad\\
    \\
    \hline
\end{array}
$$

$P(AB)$是全局概率，它的样本空间是全局的；而$P(A|B)$是条件概率，样本空间是局部的。

## 条件概率是概率
条件概率虽然是被推广出来的定义，但这种推广也是很合理的，一方面符合过往的经验（可以用古典派进行验算），另外一方面符合概率三大公理：
对于条件概率P(A|B)，满足以下三大公理：
1. 非负性公理：$P(A|B)\ge 0$
2. 规范性公理：$P(\Omega|B) = 1$
3. 可加性公理：设$A_1、A_2、\cdots$为两两不相容的事件，即$A_i\cap A_j=\varnothing（i\ne j）$，有：
$$
P\left(\bigcup_{n=1}^{\infty}A_n|B\right)=\sum_{n=1}^{\infty}P\left(A_n|B\right)
$$
证明了条件概率是数学意义上的概率之后，马上就知道了，之前所做的推论在条件概率上也成立：
$$
\begin{array}{c|c}
    \hline
    \quad\quad&\quad 概率\quad&\quad 条件概率\quad\\
    \hline
    \\
    \quad\color{Orange}{空集}\quad&\quad P(\varnothing)=0\quad&\quad P(\varnothing |C)=0\quad\\
    \\
    \hline
    \\
    \quad \color{ForestGreen}{包含}\quad&\quad P(B-A)=P(B)-P(A)\quad&\quad P(B-A|C)=P(B|C)-P(A|C)\quad\\
    \\
    \quad (A\subseteq B)\quad&\quad P(A) \le P(B)\quad&\quad P(A|C) \le P(B|C)\quad\\
    \\
    \hline
    \\
    \quad \color{Magenta}{加法}\quad&\quad \begin{aligned}P(A+B)=&P(A)+P(B)\\&-P(AB)\end{aligned}\quad&\quad \begin{aligned}P(A+B|C)=&P(A|C)+P(B|C)\\&-P(AB|C)\end{aligned}\quad
    \\
    \\\hline
\end{array}
$$

## 乘法公式
从条件概率的定义可以推出`乘法公式`：
1. 若$P(B) > 0$，则：$P(AB)=P(B)P(A|B)$
2. 若$P(A) > 0$，则：$P(AB)=P(A)P(B|A)$
3. 若$P(A_1\cdots A_n) > 0$，则：$P(A_1\cdots A_n)=P(A_1)P(A_2|A_1)P(A_3|A_1A_2)\cdots P(A_n|A_1\cdots A_{n-1})$
（3）式有点难记，其实还是有规律的。也可以手动来推，只需要反复运用条件概率的定义即可：
$$
\begin{aligned}
    P(A_1A_2A_3)
        &=P(A_1A_2)P(A_3|A_1A_2)\\
        \\
        &=P(A_1)P(A_2|A_1)P(A_3|A_1A_2)
\end{aligned}
$$








## 条件概率
之前是如下计算概率的：
$$
P(A)=\frac{|A|}{|\Omega|}=\frac{|A\cap\Omega|}{|\Omega|}
$$
新增条件B后，要把样本空间$\Omega$替换为B，所以：
$$
P(A|\color{red}{B})=\frac{|A\cap \color{red}{B}|}{|\color{red}{B}|}=\frac{1}{4}
$$
上面的计算只适用于古典派的概率，但可以推广到更广泛的抽象概率上去：
设A和B是样本空间$\Omega$中的两事件，则称：
$$
P(A|B)=\frac{P(A\cap B)}{P(B)}
$$
为“假设条件为B时的A的概率”，简称`条件概率`。也常写作：
$$
P(A|B)=\frac{P(AB)}{P(B)}
$$


两者最重要的区别是：
- $P(A)$是以$\Omega$为样本空间，这是一个全局的空间，包含所有可能性
- $P(A|B)$是以$B$为样本空间，相对而言是一个局部空间，有些可能性被排除掉了






## 严格定义
### 古典概率
先来看一个问题，这里两个杯子，就称作B杯和C杯吧，里面装着红球、蓝球：
[](./条件概率/21.png)
在两个杯子中任意抽出一个球，得到蓝球的概率有多大？假设事件为$A=“抽取一次得到蓝球”$，样本空间$\Omega$和事件$A$可以分别画在韦恩图上：
[](./条件概率/22.png)
那么根据古典派，可以知道：
$$
P(A)=\frac{|A|}{|\Omega|}=\frac{3}{8}
$$
### 条件概率
下面给一个条件，“从B杯中抽取”，得到蓝球的概率有多大？这个条件的出现相当于把$C$杯拿走：
[](./条件概率/23.png)
把C杯拿走，意味着从C杯中抽取的可能性消失了，也就是C事件不可能发生了，相当于样本空间缩小了成了B：
[](./条件概率/24.png)

### 局部概率
在概率的基础上推广出了条件概率（再强调下，不是证明出来的，是推广出来的），来看看古典概率和条件概率的对比：
[](./条件概率/25.png)
两者最重要的区别是：
- $P(A)$是以$\Omega$为样本空间，这是一个全局的空间，包含所有可能性
- $P(A|B)$是以$B$为样本空间，相对而言是一个局部空间，有些可能性被排除掉了

打一个不恰当的比方，同样一位学霸$A$：$P(A)$是拿他在全校进行比较，他就是全校第三名；而$P(A|B)$是在全班进行比较，所以是全班第一。
条件概率是局部概率，这就是理解条件概率的关键。



## 树形图
### 树形图
首先，从中随机抽掉一个球，有$\frac{3}{5}$的可能性抽掉红球、$\frac{2}{5}$的可能性抽掉蓝球：
[](./条件概率/27.png)
如果抽掉红球，再抽取一个蓝球的概率为$\frac{1}{2}$：
[](./条件概率/28.png)
如果抽掉蓝球，再抽取一个蓝球的概率为$\frac{1}{4}$：
[](./条件概率/29.png)
### 解题
抽掉红球之后，再抽取一个蓝球的概率，可以沿着最上面的支线来计算:
[](./条件概率/30.png)
而抽掉蓝球之后，再抽取一个蓝球的概率，可以沿着中间的支线来计算：
[](./条件概率/31.png)
这样，随机抽掉一个球后，再抽取一个蓝球的概率是两条直线之和：
$$
\frac{3}{10}+\frac{1}{10}=\frac{4}{10}
$$
### 验算
如果树形图穷尽了所有的情况，且计算没有出错，那所有的分支概率之和应该为1；如果加起来不为1，说明有错漏，这个特点可以用来验算。来看看本题的所有分支：
[](./条件概率/32.png)
所有分支的概率之和确实为1：
$$
\frac{3}{10}+\frac{3}{10}+\frac{1}{10}+\frac{3}{10}=1
$$


### 树形图与条件概率
看着刚才那道题的树形图：
[](./条件概率/33.png)
把这道题用代数来翻译下：
$$
\begin{array}{c|c}
    \hline
    \\
    \quad 抽掉红球的概率为\frac{3}{5}\quad&\quad P(A)=\frac{3}{5}\quad\\
    \quad 抽掉蓝球的概率为\frac{2}{5}\quad&\quad P(B)=\frac{2}{5}\quad\\
    \quad 抽掉红球后抽取蓝球的概率为\frac{1}{2}\quad&\quad P(C|A)=\frac{1}{2}\quad\\
    \quad 抽掉蓝球后抽取蓝球的概率为\frac{1}{4}\quad&\quad P(C|B)=\frac{1}{4}\quad\\
    \quad 求，抽取蓝球的概率为多少？\quad&\quad P(C)=\color{red}{?}\quad\\
    \\
    \hline
\end{array}
$$
其实这是一个条件概率的题，把这些概率符号标注到图上：
[](./条件概率/35.png)
这里也可以看出条件概率的样本空间是局部样本空间：
[](./条件概率/36.png)

### 树形图与乘法公式
刚才求的抽掉红球后，再抽取一个蓝球的概率：
[](./条件概率/37.png)
其实就是乘法公式的一次应用：
$$
P(AC)=P(A)P(C|A)=\frac{3}{5}\times\frac{1}{2}=\frac{3}{10}
$$




参考:
马同学


