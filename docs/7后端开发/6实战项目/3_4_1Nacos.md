# Nacos

## Nacos特性

- 服务发现和服务健康监测

    Nacos 支持基于 DNS 和基于 RPC 的服务发现。Nacos 提供对服务的实时的健康检查，阻止向不健康的主机或服务实例发送请求。Nacos 支持传输层 (PING 或 TCP)和应用层 (如 HTTP、MySQL、用户自定义）的健康检查。 对于复杂的云环境和网络拓扑环境中（如 VPC、边缘网络等）服务的健康检查，Nacos 提供了 agent 上报模式和服务端主动检测2种健康检查模式。

- 动态配置服务

    Nacos 提供了一个简洁易用的UI 管理所有的服务和应用的配置。提供包括配置版本跟踪、金丝雀发布、一键回滚配置以及客户端配置更新状态跟踪在内的一系列开箱即用的配置管理特性。

- 动态 DNS 服务

    动态 DNS 服务支持权重路由， 更灵活的路由策略、流量控制以及数据中心内网的简单DNS解析服务。动态DNS服务能更容易地实现以 DNS 协议为基础的服务发现，Nacos 提供了一些简单的 DNS APIs TODO 帮助管理服务的关联域名和可用的 IP:PORT 列表.

- 服务及其元数据管理

    Nacos 可视化管理所有服务及元数据，包括管理服务的描述、生命周期、服务的静态依赖分析、服务的健康状态、服务的流量管理、路由及安全策略、服务的 SLA 以及最首要的 metrics 统计数据。

## Nacos架构设计

1. 基本架构

    ![](金融项目/nacos_design.jpeg)

    主要分为Nacos Server 和 Nacos Console。 Nacos Server 主要包含:

    - ConfigService:  配置服务， 提供服务动态配置，元数据以及配置管理的服务的提供者。
    - Naming Service: 名称服务， 提供对象的名称与关联的元数据之间的映射管理服务，服务发现和DNS服务就是名称服务的主要应用场景， 比如ServiceName -> Endpoints Info；  DNS Domain Name -> IP 。

    ✨什么是元数据？ 是指包括服务端点(endpoints)、服务标签、服务版本号、服务实例权重、路由规则、安全策略等描述服务的数据。

2. 逻辑架构

    ![nacos_logic_design](金融项目/nacos_logic_design.png)

    采用领域模型， 模块化设计， 可插拔式插件管理； OpenAPI（标准Rest风格HTTP接口）统一接入，一致性协议与统一存储， 保障数据的一致性与分区容错性。

    领域模型设计：

    什么是领域设计?  业务领域内的人员,  比如专家、设计人员、开发人员,  以一种大家都能理解的语言作为相互交流的工具， 在交流过程中， 不断发现， 并抽象形成具体的概念， 将这些概念设计成一个领域模型， 由领域模型驱动软件设计，用代码来实现该领域模型， 这个就称为领域设计。

    - 数据模型： Nacos 数据模型 Key 由三元组唯一确定, Namespace默认是空串，公共命名空间（public），分组默认是 DEFAULT_GROUP。

    - 服务领域模型：该服务领域存在三个层级， 服务、集群与实例。服务包含健康检查、元数据、路由机制与阈值保护； 集群包含健康检查、元数据和同步机制； 实例则包含IP、端口、权重、运行状态、元数据和响应时间等。

    - 配置领域模型：主要两个实体， 一个是配置变更历史， 一个是服务标签， 通过ID关联 。

    ![](金融项目/nacos_config_domain.jpeg)

3. UML类视图设计

   ![](金融项目/nacos_uml.jpeg)

## 服务设计

- 配置服务

  ![](金融项目/nacos_config_server.png)

- 注册服务

  ![](金融项目/nacos_register_server.png)
