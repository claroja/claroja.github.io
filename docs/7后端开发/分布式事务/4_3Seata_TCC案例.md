# Seata_TCCæ¡ˆä¾‹


## æœ€ä½³å®è·µ

### è€ƒå¯Ÿé—®

- åŒæ­¥å‹TCCè§£å†³æ–¹æ¡ˆ: 
    - æ¦‚å¿µ: æ‰€æœ‰`()`ä¸šåŠ¡æœåŠ¡æ˜¯`()`è°ƒç”¨, éƒ½éœ€å‚ä¸åˆ°ä¸»ä¸šåŠ¡æœåŠ¡çš„`()`å½“ä¸­ã€‚
    - é€‚ç”¨åœºæ™¯: æ‰§è¡Œæ—¶é—´`()`ä¸”è¾ƒ`()`çš„ä¸šåŠ¡
- å¼‚æ­¥å‹TCCè§£å†³æ–¹æ¡ˆ: 
    - æ¦‚å¿µ: `()`ä»ä¸šåŠ¡æœåŠ¡æ˜¯`()`æœåŠ¡ï¼Œè€Œ`()`çš„ä»ä¸šåŠ¡æœåŠ¡åˆ™é€šè¿‡æ¶ˆæ¯æœåŠ¡è§£è€¦ï¼Œä½œä¸ºæ¶ˆæ¯æœåŠ¡çš„`()`ï¼Œå¼‚æ­¥åœ°æ‰§è¡Œã€‚
    - ä½¿ç”¨åœºæ™¯: `()`å‹ä¸šåŠ¡: ä»ä¸šåŠ¡æœåŠ¡çš„å¤„ç†ç»“æœ`()`å½±å“ä¸»ä¸šåŠ¡æœåŠ¡çš„å†³ç­–ï¼Œåªè¢«åŠ¨çš„æ¥æ”¶ä¸»ä¸šåŠ¡æœåŠ¡çš„å†³ç­–ç»“æœ
    - å…·ä½“:

        - Try æ¥å£é¢„å‘é€ï¼Œåªè´Ÿè´£`()`åŒ–å­˜å‚¨æ¶ˆæ¯æ•°æ®ï¼›
        - Confirm æ¥å£ç¡®è®¤å‘é€ï¼Œè¿™æ—¶æ‰å¼€å§‹çœŸæ­£çš„`()`æ¶ˆæ¯ï¼›
        - Cancel æ¥å£å–æ¶ˆå‘é€ï¼Œ`()`æ¶ˆæ¯æ•°æ®ã€‚

### è€ƒå¯Ÿç‚¹

- åŒæ­¥å‹TCCè§£å†³æ–¹æ¡ˆ: 
    - æ¦‚å¿µ: æ‰€æœ‰`ä»`ä¸šåŠ¡æœåŠ¡æ˜¯`åŒæ­¥`è°ƒç”¨, éƒ½éœ€å‚ä¸åˆ°ä¸»ä¸šåŠ¡æœåŠ¡çš„`å†³ç­–`å½“ä¸­ã€‚
    - é€‚ç”¨åœºæ™¯: æ‰§è¡Œæ—¶é—´`ç¡®å®š`ä¸”è¾ƒ`çŸ­`çš„ä¸šåŠ¡
- å¼‚æ­¥å‹TCCè§£å†³æ–¹æ¡ˆ: 
    - æ¦‚å¿µ: `ç›´æ¥`ä»ä¸šåŠ¡æœåŠ¡æ˜¯`å¯é æ¶ˆæ¯`æœåŠ¡ï¼Œè€Œ`çœŸæ­£`çš„ä»ä¸šåŠ¡æœåŠ¡åˆ™é€šè¿‡æ¶ˆæ¯æœåŠ¡è§£è€¦ï¼Œä½œä¸ºæ¶ˆæ¯æœåŠ¡çš„`æ¶ˆè´¹ç«¯`ï¼Œå¼‚æ­¥åœ°æ‰§è¡Œã€‚
    - ä½¿ç”¨åœºæ™¯: `è¢«åŠ¨`å‹ä¸šåŠ¡: ä»ä¸šåŠ¡æœåŠ¡çš„å¤„ç†ç»“æœ`ä¸`å½±å“ä¸»ä¸šåŠ¡æœåŠ¡çš„å†³ç­–ï¼Œåªè¢«åŠ¨çš„æ¥æ”¶ä¸»ä¸šåŠ¡æœåŠ¡çš„å†³ç­–ç»“æœ
    - å…·ä½“:

        - Try æ¥å£é¢„å‘é€ï¼Œåªè´Ÿè´£`æŒä¹…`åŒ–å­˜å‚¨æ¶ˆæ¯æ•°æ®ï¼›
        - Confirm æ¥å£ç¡®è®¤å‘é€ï¼Œè¿™æ—¶æ‰å¼€å§‹çœŸæ­£çš„`æŠ•é€’`æ¶ˆæ¯ï¼›
        - Cancel æ¥å£å–æ¶ˆå‘é€ï¼Œ`åˆ é™¤`æ¶ˆæ¯æ•°æ®ã€‚



## é€šç”¨å‹ TCC è§£å†³æ–¹æ¡ˆ

### åŸºæœ¬æ¦‚å¿µ

æ‰€æœ‰`ä»`ä¸šåŠ¡æœåŠ¡éƒ½éœ€è¦å‚ä¸åˆ°ä¸»ä¸šåŠ¡æœåŠ¡çš„`å†³ç­–`å½“ä¸­ã€‚

![alt text](åˆ†å¸ƒå¼äº‹åŠ¡/Seata_TCC10.png)

### é€‚ç”¨åœºæ™¯

ç”±äºä»ä¸šåŠ¡æœåŠ¡æ˜¯`åŒæ­¥`è°ƒç”¨ï¼Œå…¶ç»“æœä¼šå½±å“åˆ°ä¸»ä¸šåŠ¡æœåŠ¡çš„`å†³ç­–`ï¼Œå› æ­¤é€šç”¨å‹ TCC åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆé€‚ç”¨äºæ‰§è¡Œæ—¶é—´`ç¡®å®š`ä¸”è¾ƒ`çŸ­`çš„ä¸šåŠ¡ï¼Œæ¯”å¦‚äº’è”ç½‘é‡‘èä¼ä¸šæœ€æ ¸å¿ƒçš„ä¸‰ä¸ªæœåŠ¡ï¼šäº¤æ˜“ã€æ”¯ä»˜ã€è´¦åŠ¡ï¼š

1. é¦–å…ˆè®¿é—®äº¤æ˜“æœåŠ¡ï¼Œåˆ›å»ºäº¤æ˜“è®¢å•
2. ç„¶åäº¤æ˜“æœåŠ¡è°ƒç”¨æ”¯ä»˜æœåŠ¡ä¸ºè¯¥äº¤æ˜“åˆ›å»ºæ”¯ä»˜è®¢å•ï¼Œæ‰§è¡Œæ”¶æ¬¾åŠ¨ä½œ
3. æœ€åæ”¯ä»˜æœåŠ¡è°ƒç”¨è´¦åŠ¡æœåŠ¡è®°å½•è´¦æˆ·æµæ°´å’Œè®°è´¦ã€‚

ä¸ºäº†ä¿è¯ä¸‰ä¸ªæœåŠ¡ä¸€èµ·å®Œæˆä¸€ç¬”äº¤æ˜“ï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ï¼Œå¯ä»¥ä½¿ç”¨é€šç”¨å‹ TCC è§£å†³æ–¹æ¡ˆï¼Œå°†è¿™ä¸‰ä¸ªæœåŠ¡æ”¾åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ä¸­ï¼Œäº¤æ˜“ä½œä¸ºä¸»ä¸šåŠ¡æœåŠ¡ï¼Œæ”¯ä»˜ä½œä¸ºä»ä¸šåŠ¡æœåŠ¡ï¼Œè´¦åŠ¡ä½œä¸ºæ”¯ä»˜æœåŠ¡çš„åµŒå¥—ä»ä¸šåŠ¡æœåŠ¡ï¼Œç”± TCC æ¨¡å‹ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ã€‚

![alt text](åˆ†å¸ƒå¼äº‹åŠ¡/Seata_TCC11.png)

æ”¯ä»˜æœåŠ¡çš„ Try æ¥å£åˆ›å»ºæ”¯ä»˜è®¢å•ï¼Œå¼€å¯åµŒå¥—åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå¹¶è°ƒç”¨è´¦åŠ¡æœåŠ¡çš„ Try æ¥å£ï¼›è´¦åŠ¡æœåŠ¡åœ¨ Try æ¥å£ä¸­å†»ç»“ä¹°å®¶èµ„é‡‘ã€‚ä¸€é˜¶æ®µè°ƒç”¨å®Œæˆåï¼Œäº¤æ˜“å®Œæˆï¼Œæäº¤æœ¬åœ°äº‹åŠ¡ï¼Œç”± TCC æ¡†æ¶å®Œæˆåˆ†å¸ƒå¼äº‹åŠ¡å„ä»ä¸šåŠ¡æœåŠ¡äºŒé˜¶æ®µçš„è°ƒç”¨ã€‚

æ”¯ä»˜æœåŠ¡äºŒé˜¶æ®µå…ˆè°ƒç”¨è´¦åŠ¡æœåŠ¡çš„ Confirm æ¥å£ï¼Œæ‰£é™¤ä¹°å®¶å†»ç»“èµ„é‡‘ï¼›å¢åŠ å–å®¶å¯ç”¨èµ„é‡‘ã€‚è°ƒç”¨æˆåŠŸåï¼Œæ”¯ä»˜æœåŠ¡ä¿®æ”¹æ”¯ä»˜è®¢å•ä¸ºå®ŒæˆçŠ¶æ€ï¼Œå®Œæˆæ”¯ä»˜ã€‚

å½“æ”¯ä»˜å’Œè´¦åŠ¡æœåŠ¡äºŒé˜¶æ®µéƒ½è°ƒç”¨å®Œæˆåï¼Œæ•´ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ç»“æŸã€‚

### ä»£ç æ¡ˆä¾‹

ğŸŒ°ç”¨æˆ·ä¸‹å•æ—¶ï¼Œç³»ç»Ÿéœ€è¦ï¼š

1. åˆ›å»ºè®¢å•è®°å½•ã€‚
2. å†»ç»“å•†å“åº“å­˜ã€‚
3. æ‰£æ¬¾å¹¶è®°å½•æ”¯ä»˜çŠ¶æ€ã€‚

å¦‚æœä»»ä¸€æ­¥éª¤å¤±è´¥ï¼Œåˆ™å›æ»šæ‰€æœ‰æ“ä½œã€‚

- æ•°æ®åº“è®¾è®¡

    è®¢å•è¡¨

    ```sql
    CREATE TABLE `orders` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `user_id` BIGINT NOT NULL,
    `product_id` BIGINT NOT NULL,
    `quantity` INT NOT NULL,
    `total_amount` DECIMAL(10, 2) NOT NULL,
    `status` VARCHAR(20) NOT NULL DEFAULT 'PENDING' -- PENDING, CONFIRMED, CANCELLED
    );
    ```

    åº“å­˜è¡¨

    ```sql

    CREATE TABLE `inventory` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `product_id` BIGINT NOT NULL,
    `total_stock` INT NOT NULL,
    `frozen_stock` INT NOT NULL DEFAULT 0
    ); 
    ```

    æ”¯ä»˜è¡¨

    ```sql
    CREATE TABLE `payment` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `order_id` BIGINT NOT NULL,
    `user_id` BIGINT NOT NULL,
    `amount` DECIMAL(10, 2) NOT NULL,
    `status` VARCHAR(20) NOT NULL DEFAULT 'PENDING' -- PENDING, SUCCESS, FAILED
    );

    ```

- è®¢å•æœåŠ¡(Order Service)

    è®¢å•æœåŠ¡ä½œä¸ºå…¨å±€äº‹åŠ¡çš„å‘èµ·è€…ï¼Œåè°ƒåº“å­˜å’Œæ”¯ä»˜æœåŠ¡ã€‚

    - TCCæ¥å£

        ```java
        public interface OrderTccService {
            @TwoPhaseBusinessAction(name = "OrderTccAction", commitMethod = "confirm", rollbackMethod = "cancel")
            void tryCreate(OrderDTO orderDTO, @BusinessActionContextParameter(paramName = "orderId") Long orderId);
            boolean confirm(BusinessActionContext context);
            boolean cancel(BusinessActionContext context);
        }
        ```

    - TCCå®ç°

        ```java
        @Service
        public class OrderTccServiceImpl implements OrderTccService {
            @Autowired
            private OrderMapper orderMapper;  // æ“ä½œæ•°æ®åº“
            @Autowired
            private InventoryClient inventoryClient;  //Feign å®¢æˆ·ç«¯
            @Autowired
            private PaymentClient paymentClient;  //Feign å®¢æˆ·ç«¯

            @Override
            @Transactional  //ç®¡ç†æœ¬åœ°æ•°æ®åº“äº‹åŠ¡æäº¤ä¸å›æ»š
            public void tryCreate(OrderDTO orderDTO, Long orderId) {  // ç¬¬ä¸€é˜¶æ®µ, try
                
                // åˆ›å»ºè®¢å•
                Order order = new Order();
                order.setUserId(orderDTO.getUserId());
                order.setProductId(orderDTO.getProductId());
                order.setQuantity(orderDTO.getQuantity());
                order.setTotalAmount(orderDTO.getTotalAmount());
                order.setStatus("PENDING");
                orderMapper.insert(order);
                // è°ƒç”¨åº“å­˜å’Œæ”¯ä»˜æœåŠ¡
                inventoryClient.freezeStock(order.getProductId(), order.getQuantity());  // è°ƒç”¨åº“å­˜æœåŠ¡å†»ç»“åº“å­˜
                paymentClient.freezePayment(order.getId(), order.getTotalAmount());  // è°ƒç”¨æ”¯ä»˜æœåŠ¡å†»ç»“é‡‘é¢
            }

            @Override
            public boolean confirm(BusinessActionContext context) {  // ç¬¬äºŒé˜¶æ®µ, confirm
                Long orderId = (Long) context.getActionContext("orderId");
                Order order = orderMapper.selectById(orderId);
                order.setStatus("CONFIRMED");  //confirmé˜¶æ®µåªæ˜¯å°†çŠ¶æ€ä»PENDINGä¿®æ”¹ä¸ºCONFIRMED
                orderMapper.updateById(order);
                return true;
            }

            @Override
            public boolean cancel(BusinessActionContext context) {  // ç¬¬ä¸‰é˜¶æ®µ, cancel
                Long orderId = (Long) context.getActionContext("orderId");
                Order order = orderMapper.selectById(orderId);
                order.setStatus("CANCELLED");
                orderMapper.updateById(order);
                return true;
            }
        }
        ```

- åº“å­˜æœåŠ¡ï¼ˆInventory Serviceï¼‰

    åº“å­˜æœåŠ¡å®ç°å†»ç»“ã€ç¡®è®¤å’Œå–æ¶ˆé€»è¾‘ã€‚

    - TCCæ¥å£

        ```java
        public interface InventoryTccService {
            @TwoPhaseBusinessAction(name = "InventoryTccAction", commitMethod = "confirm", rollbackMethod = "cancel")
            void freezeStock(@BusinessActionContextParameter(paramName = "productId") Long productId, Integer quantity);
            boolean confirm(BusinessActionContext context);
            boolean cancel(BusinessActionContext context);
        }
        ```

    - TCCå®ç°

        ```java
        @RestController
        @RequestMapping("/inventory")
        public class InventoryTccServiceImpl implements InventoryTccService {
            
            @Autowired
            private InventoryMapper inventoryMapper;

            @Override
            @PostMapping("/freeze")
            @Transactional
            public void freezeStock(Long productId, Integer quantity) {
                Inventory inventory = inventoryMapper.selectByProductId(productId);
                if (inventory.getTotalStock() - inventory.getFrozenStock() < quantity) { //quantityæ˜¯æœ¬æ¬¡ä¸‹å•çš„é‡, åº“å­˜é‡å‡å»å·²ç»å†»ç»“é‡(å…¶ä»–å†»ç»“)å¿…é¡»å¤§äºæœ¬æ¬¡ä¸‹å•é‡
                    throw new RuntimeException("Insufficient stock");
                }
                inventory.setFrozenStock(inventory.getFrozenStock() + quantity); //å¢åŠ æœ¬æ¬¡å†»ç»“çš„é‡
                inventoryMapper.updateById(inventory);
            }

            @Override
            public boolean confirm(BusinessActionContext context) {
                Long productId = (Long) context.getActionContext("productId");
                Inventory inventory = inventoryMapper.selectByProductId(productId);
                Integer quantity = (Integer) context.getActionContext("quantity");
                inventory.setFrozenStock(inventory.getFrozenStock() - quantity); // å†»ç»“é‡å‡å»
                inventory.setTotalStock(inventory.getTotalStock() - quantity); // æ€»é‡å‡å»
                inventoryMapper.updateById(inventory);
                return true;
            }

            @Override
            public boolean cancel(BusinessActionContext context) {
                Long productId = (Long) context.getActionContext("productId");
                Inventory inventory = inventoryMapper.selectByProductId(productId);
                Integer quantity = (Integer) context.getActionContext("quantity");
                inventory.setFrozenStock(inventory.getFrozenStock() - quantity); // å†»ç»“é‡å‡å»
                inventoryMapper.updateById(inventory);
                return true;
            }
        }
        ```

- æ”¯ä»˜æœåŠ¡ï¼ˆPayment Serviceï¼‰

    æ”¯ä»˜æœåŠ¡å¤„ç†æ”¯ä»˜å†»ç»“å’Œæ‰£æ¬¾ã€‚

    - TCCæ¥å£

        ```java
        public interface PaymentTccService {
            @TwoPhaseBusinessAction(name = "PaymentTccAction", commitMethod = "confirm", rollbackMethod = "cancel")
            void freezePayment(@BusinessActionContextParameter(paramName = "orderId") Long orderId, BigDecimal amount);
            boolean confirm(BusinessActionContext context);
            boolean cancel(BusinessActionContext context);
        }
        ```

    - TCCå®ç°

        ```java
        @RestController
        @RequestMapping("/payment")
        public class PaymentTccServiceImpl implements PaymentTccService {
            @Autowired
            private PaymentMapper paymentMapper;

            @Override
            @PostMapping("/freeze")
            @Transactional
            public void freezePayment(Long orderId, BigDecimal amount) {
                Payment payment = new Payment();
                payment.setOrderId(orderId);
                payment.setAmount(amount);
                payment.setStatus("PENDING");
                paymentMapper.insert(payment);
            }

            @Override
            public boolean confirm(BusinessActionContext context) {
                Long orderId = (Long) context.getActionContext("orderId");
                Payment payment = paymentMapper.selectByOrderId(orderId);
                payment.setStatus("SUCCESS");
                paymentMapper.updateById(payment);
                return true;
            }

            @Override
            public boolean cancel(BusinessActionContext context) {
                Long orderId = (Long) context.getActionContext("orderId");
                Payment payment = paymentMapper.selectByOrderId(orderId);
                payment.setStatus("FAILED");
                paymentMapper.updateById(payment);
                return true;
            }
        }
        ```

- å…¨å±€äº‹åŠ¡å‘èµ·

    åœ¨è®¢å•æœåŠ¡ä¸­ï¼Œä½¿ç”¨ @GlobalTransactional æ³¨è§£å‘èµ·å…¨å±€äº‹åŠ¡ï¼š

    ```java
    @RestController
    @RequestMapping("/order")
    public class OrderController {
        @Autowired
        private OrderTccService orderTccService;

        @PostMapping("/create")
        @GlobalTransactional
        public String createOrder(@RequestBody OrderDTO orderDTO) {
            orderTccService.tryCreate(orderDTO, null);
            return "Order created successfully";
        }
    }
    ```

    ![alt text](åˆ†å¸ƒå¼äº‹åŠ¡/TCCæ¡ˆä¾‹.svg)

## å¼‚æ­¥ç¡®ä¿å‹ TCC è§£å†³æ–¹æ¡ˆ

### åŸºæœ¬æ¦‚å¿µ

å¼‚æ­¥ç¡®ä¿å‹ TCC è§£å†³æ–¹æ¡ˆçš„`ç›´æ¥`ä»ä¸šåŠ¡æœåŠ¡æ˜¯`å¯é æ¶ˆæ¯`æœåŠ¡ï¼Œè€Œ`çœŸæ­£`çš„ä»ä¸šåŠ¡æœåŠ¡åˆ™é€šè¿‡æ¶ˆæ¯æœåŠ¡è§£è€¦ï¼Œä½œä¸ºæ¶ˆæ¯æœåŠ¡çš„`æ¶ˆè´¹ç«¯`ï¼Œå¼‚æ­¥åœ°æ‰§è¡Œã€‚

![alt text](åˆ†å¸ƒå¼äº‹åŠ¡/Seata_TCC12.png)

å¯é æ¶ˆæ¯æœåŠ¡éœ€è¦æä¾› Tryï¼ŒConfirmï¼ŒCancel ä¸‰ä¸ªæ¥å£ã€‚

- Try æ¥å£é¢„å‘é€ï¼Œåªè´Ÿè´£æŒä¹…åŒ–å­˜å‚¨æ¶ˆæ¯æ•°æ®ï¼›
- Confirm æ¥å£ç¡®è®¤å‘é€ï¼Œè¿™æ—¶æ‰å¼€å§‹çœŸæ­£çš„æŠ•é€’æ¶ˆæ¯ï¼›
- Cancel æ¥å£å–æ¶ˆå‘é€ï¼Œåˆ é™¤æ¶ˆæ¯æ•°æ®ã€‚

æ¶ˆæ¯æœåŠ¡çš„æ¶ˆæ¯æ•°æ®ç‹¬ç«‹å­˜å‚¨ï¼Œç‹¬ç«‹ä¼¸ç¼©ï¼Œé™ä½ä»ä¸šåŠ¡æœåŠ¡ä¸æ¶ˆæ¯ç³»ç»Ÿé—´çš„è€¦åˆï¼Œåœ¨æ¶ˆæ¯æœåŠ¡å¯é çš„å‰æä¸‹ï¼Œå®ç°åˆ†å¸ƒå¼äº‹åŠ¡çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚

æ­¤è§£å†³æ–¹æ¡ˆè™½ç„¶å¢åŠ äº†æ¶ˆæ¯æœåŠ¡çš„ç»´æŠ¤æˆæœ¬ï¼Œä½†ç”±äºæ¶ˆæ¯æœåŠ¡ä»£æ›¿ä»ä¸šåŠ¡æœåŠ¡å®ç°äº† TCC æ¥å£ï¼Œä»ä¸šåŠ¡æœåŠ¡ä¸éœ€è¦ä»»ä½•æ”¹é€ ï¼Œæ¥å…¥æˆæœ¬éå¸¸ä½ã€‚

### é€‚ç”¨åœºæ™¯

ç”±äºä»ä¸šåŠ¡æœåŠ¡æ¶ˆè´¹æ¶ˆæ¯æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„è¿‡ç¨‹ï¼Œæ‰§è¡Œæ—¶é—´ä¸ç¡®å®šï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸ä¸€è‡´æ—¶é—´çª—å£å¢åŠ ã€‚å› æ­¤ï¼Œå¼‚æ­¥ç¡®ä¿æ€§ TCC åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆåªé€‚ç”¨äºå¯¹æœ€ç»ˆä¸€è‡´æ€§æ—¶é—´æ•æ„Ÿåº¦è¾ƒä½çš„ä¸€äº›`è¢«åŠ¨`å‹ä¸šåŠ¡ï¼ˆä»ä¸šåŠ¡æœåŠ¡çš„å¤„ç†ç»“æœ`ä¸`å½±å“ä¸»ä¸šåŠ¡æœåŠ¡çš„å†³ç­–ï¼Œåªè¢«åŠ¨çš„æ¥æ”¶ä¸»ä¸šåŠ¡æœåŠ¡çš„å†³ç­–ç»“æœï¼‰ã€‚æ¯”å¦‚ä¼šå‘˜æ³¨å†ŒæœåŠ¡å’Œé‚®ä»¶å‘é€æœåŠ¡ï¼š

å½“ç”¨æˆ·æ³¨å†Œä¼šå‘˜æˆåŠŸï¼Œéœ€è¦ç»™ç”¨æˆ·å‘é€ä¸€å°é‚®ä»¶ï¼Œå‘Šè¯‰ç”¨æˆ·æ³¨å†ŒæˆåŠŸï¼Œå¹¶æç¤ºç”¨æˆ·æ¿€æ´»è¯¥ä¼šå‘˜ã€‚ä½†è¦æ³¨æ„ä¸¤ç‚¹ï¼š

- å¦‚æœç”¨æˆ·æ³¨å†ŒæˆåŠŸï¼Œä¸€å®šè¦ç»™ç”¨æˆ·å‘é€ä¸€å°é‚®ä»¶ï¼›
- å¦‚æœç”¨æˆ·æ³¨å†Œå¤±è´¥ï¼Œä¸€å®šä¸èƒ½ç»™ç”¨æˆ·å‘é€é‚®ä»¶ã€‚

å› æ­¤ï¼Œè¿™åŒæ ·éœ€è¦ä¼šå‘˜æœåŠ¡å’Œé‚®ä»¶æœåŠ¡ä¿è¯åŸå­æ€§ï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚ä¸ä¸€æ ·çš„æ˜¯ï¼Œé‚®ä»¶æœåŠ¡åªæ˜¯ä¸€ç§è¢«åŠ¨å‹çš„ä¸šåŠ¡ï¼Œå¹¶ä¸å½±å“ç”¨æˆ·æ˜¯å¦èƒ½å¤Ÿæ³¨å†ŒæˆåŠŸï¼Œå®ƒåªéœ€è¦åœ¨ç”¨æˆ·æ³¨å†ŒæˆåŠŸä»¥åå‘é€é‚®ä»¶ç»™ç”¨æˆ·å³å¯ï¼Œé‚®ä»¶æœåŠ¡ä¸éœ€è¦å‚ä¸åˆ°ä¼šå‘˜æœåŠ¡çš„æ´»åŠ¨å†³ç­–ä¸­ã€‚

å¯¹äºæ­¤ç§ä¸šåŠ¡åœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨å¼‚æ­¥ç¡®ä¿å‹TCCåˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œå¦‚ä¸‹ï¼š

![alt text](åˆ†å¸ƒå¼äº‹åŠ¡/Seata_TCC13.png)

ç”±å¯é æ¶ˆæ¯æœåŠ¡æ¥è§£è€¦ä¼šå‘˜å’Œé‚®ä»¶æœåŠ¡ï¼Œä¼šå‘˜æœåŠ¡ä¸æ¶ˆæ¯æœåŠ¡ç»„æˆ TCC äº‹åŠ¡æ¨¡å‹ï¼Œä¿è¯äº‹åŠ¡åŸå­æ€§ã€‚ç„¶åé€šè¿‡æ¶ˆæ¯æœåŠ¡çš„å¯é ç‰¹æ€§ï¼Œç¡®ä¿æ¶ˆæ¯ä¸€å®šèƒ½å¤Ÿè¢«é‚®ä»¶æœåŠ¡æ¶ˆè´¹ï¼Œä»è€Œä½¿å¾—ä¼šå‘˜ä¸é‚®ä»¶æœåŠ¡åœ¨åŒä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ä¸­ã€‚åŒæ—¶ï¼Œé‚®ä»¶æœåŠ¡ä¹Ÿä¸ä¼šå½±å“ä¼šå‘˜æœåŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œåªåœ¨ä¼šå‘˜æœåŠ¡æ‰§è¡ŒæˆåŠŸåè¢«åŠ¨æ¥æ”¶å‘é€é‚®ä»¶çš„è¯·æ±‚ã€‚


## å‚è€ƒ

- <https://juejin.cn/post/7487816112626024475>
- <https://seata.apache.org/zh-cn/blog/tcc-mode-applicable-scenario-analysis/>
